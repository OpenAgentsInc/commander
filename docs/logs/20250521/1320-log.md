# Fixing App Initialization Infinite Update Loop

## Analysis of the Problem

Based on the instructions, the primary issue is with the `useLayoutEffect` hook in `App.tsx` causing a state update that triggers another re-render, leading to the "Maximum update depth exceeded" error.

The issue stems from:
1. Using `useLayoutEffect` to check and initialize wallet setup
2. The synchronous nature of `useLayoutEffect` conflicting with React's rendering lifecycle
3. The state changes from opening wallet panes potentially retriggering the effect

## The Fix

The solution is to switch from `useLayoutEffect` to `useEffect` for the wallet setup check. This change allows React to complete its render cycle before the effect runs, breaking the potential infinite loop.

`useEffect` runs after the browser has painted, while `useLayoutEffect` runs synchronously after DOM mutations but before painting. For operations like opening panes that don't need to block browser painting, `useEffect` is more appropriate.

## Implementation

I'll implement the following changes to `src/App.tsx`:
1. Change `useLayoutEffect` to `useEffect` for the wallet setup check
2. Keep the `hasCheckedWalletSetup` flag to ensure the check only runs once
3. Update imports as needed

Let me make these changes now.

## Changes Made

1. Changed the React import to remove `useLayoutEffect`:
```typescript
// Before
import React, { useEffect, useLayoutEffect } from "react";

// After
import React, { useEffect } from "react";
```

2. Changed the effect hook for wallet setup check from `useLayoutEffect` to `useEffect`:
```typescript
// Before
// Use layout effect to ensure wallet setup is checked before render
useLayoutEffect(() => {
  checkWalletSetupNeeded();
}, []);

// After
// Check wallet setup after the initial render and browser paint
useEffect(() => {
  checkWalletSetupNeeded();
}, []);
```

3. The rest of the implementation remained the same, including:
   - Keeping the `hasCheckedWalletSetup` flag to ensure the check runs only once
   - Maintaining the `setTimeout` to schedule the state update outside the current call stack
   - Using direct store access with `getState()` instead of hooks

## Expected Result

By switching from `useLayoutEffect` to `useEffect`, we've changed the timing of when the wallet setup check happens. Instead of running synchronously after DOM mutations but before browser paint, it now runs after the browser has painted.

This change should prevent the infinite update loop causing the "Maximum update depth exceeded" error, as it allows React to complete its render cycle before potentially triggering another update through the pane store.

The fix maintains all the functionality while resolving the specific issue with React's rendering lifecycle. The change is minimal and targeted, addressing only the timing aspect of when the wallet setup check occurs relative to the browser paint.

## Verification

I ran `pnpm lint` to check for any TypeScript errors related to our changes. While the codebase has numerous lint errors, none are related to our modifications in App.tsx. These lint errors were already present in the codebase before our changes.

## Summary

By changing from `useLayoutEffect` to `useEffect` for the wallet setup initialization check, we've modified the timing of when the check happens in relation to React's rendering cycle. This change should prevent the "Maximum update depth exceeded" error by allowing React to complete its render cycle before potentially triggering another update through the pane store.

The key elements of our solution are:
1. Using `useEffect` instead of `useLayoutEffect` for non-blocking operations
2. Maintaining the module-level flag to ensure initialization only happens once
3. Keeping the setTimeout to schedule updates outside the current call stack
4. Using direct store access with getState() rather than hooks

These changes work together to break the synchronous chain of updates that was causing the infinite loop.